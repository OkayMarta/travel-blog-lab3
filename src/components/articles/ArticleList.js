import React, { useState, useEffect } from 'react';
import ArticleCard from './ArticleCard'; // Імпорт компонента картки статті

// Початкові дані статей (можна винести в окремий файл/модуль)
const initialArticlesData = [
    {
        id: "article1",
        title: "Гофбург – серце імперського Відня",
        date: "16.02.2025",
        image: "/images/image7.jpg", // Шлях до зображення відносно папки public
        alt: "Гофбург",
        text: [
            "Гофбург – це величний палацовий комплекс у самому серці Відня, що століттями був резиденцією австрійських монархів. Його розкішні зали, витончені фасади та внутрішні двори переносять у часи імперської величі. Сьогодні Гофбург вражає своєю архітектурною пишністю та є важливим культурним центром міста.",
            "Цікавий факт: палац служив офіційною резиденцією Габсбургів понад 600 років. Тут розташовані Імператорські покої, колекція коштовностей та знаменита Іспанська школа верхової їзди, де можна побачити елегантних липіцанських коней у дії.",
            "Гофбург зачаровує своєю історією, і кожен куточок цього палацу – мовчазний свідок минулих епох, які залишили незабутній слід у серці Відня."
        ],
        comments: [
            { name: "Іван", text: "Дуже цікаво!" },
        ],
        initialLikes: 10 // Початкова кількість лайків
    },
    {
        id: "article2",
        title: "Палац Шенбрунн – перлина Відня",
        date: "15.02.2025",
        image: "/images/image4.jpg", // Шлях до зображення
        alt: "Палац Шенбрунн",
        text: [
            "Шенбрунн – один із найвеличніших палаців Європи, що став символом імператорської величі Австрії. Розташований у Відні, цей бароковий комплекс слугував літньою резиденцією Габсбургів протягом кількох століть. Його розкішні зали пам'ятають Марію Терезію, Франца Йосифа та імператрицю Сісі.",
            "З пагорба Глорієтта відкривається вражаюча панорама на палац і місто. Навколо – доглянуті сади, що змінюються з пір року, надаючи Шенбрунну особливого шарму. Сьогодні цей історичний ансамбль є об'єктом Світової спадщини ЮНЕСКО та однією з найпопулярніших туристичних локацій Австрії.",
            "Відвідування Шенбрунна – це подорож у минуле, де велич та краса гармонійно поєднуються з історією."
        ],
        comments: [],
        initialLikes: 5
    },
    {
        id: "article3",
        title: "Собор Святого Віта – серце Праги",
        date: "05.02.2024",
        image: "/images/image5.jpg", // Шлях до зображення
        alt: "Собор Святого Віта",
        text: [
            "Собор Святого Віта – головний храм Чехії та справжній шедевр готичної архітектури. Він височіє в серці Празького граду, вражаючи своїми витонченими шпилями, величними вітражами та багатим декором. Будівництво собору тривало майже 600 років, і кожна епоха залишила свій слід у його величному образі.",
            "Цікавий факт: у соборі зберігаються королівські регалії Чехії, зокрема корона святого Вацлава, яка використовується лише під час коронації. Також тут знаходиться гробниця Карла IV – одного з найвидатніших правителів Чехії.",
            "Собор Святого Віта – це не лише місце поклоніння, а й жива історія Праги, яка зачаровує кожного, хто його відвідує."
        ],
        comments: [],
        initialLikes: 8
    },
    {
        id: "article4",
        title: "Венеція – місто на воді",
        date: "06.07.2023",
        image: "/images/image6.jpg", // Шлях до зображення
        alt: "Венеціанський канал",
        text: [
            "Венеція – унікальне місто, де вулиці замінені каналами, а автомобілі – витонченими гондолами. Прогулянка на гондолі вузькими водними шляхами – це незабутній досвід, що дозволяє відчути романтику цього стародавнього міста. Кожен канал приховує свою історію, а кожна будівля на березі – мовчазний свідок минулих століть.",
            "Цікавий факт: щоб стати гондольєром у Венеції, потрібно пройти суворе навчання та скласти іспит. У місті існує обмежена кількість ліцензій, а професія часто передається у спадок. Традиційний одяг гондольєрів – чорно-біла або червоно-біла смугаста сорочка – став одним із символів Венеції.",
            "Венеція зачаровує своєю атмосферою, і кожна подорож цими каналами – це мить, яку хочеться зберегти назавжди."
        ],
        comments: [],
        initialLikes: 12
    }
];

// Компонент списку статей
function ArticleList() {
  // Стан для зберігання списку статей (включаючи коментарі)
  const [articles, setArticles] = useState(initialArticlesData);
  // Стан для керування сортуванням за датою
  const [sortByDate, setSortByDate] = useState('desc'); // За замовчуванням - спочатку нові

  // Закоментований приклад завантаження даних з API
  // useEffect(() => {
  //   // Тут може бути fetch запит
  //   // fetch('/api/articles').then(res => res.json()).then(data => setArticles(data));
  // }, []); // Виконується один раз при монтуванні

  // Обробник зміни типу сортування
  const handleSortChange = (event) => {
    setSortByDate(event.target.value);
  };

  // Функція для додавання нового коментаря до відповідної статті
  const handleAddComment = (articleId, newComment) => {
    setArticles(currentArticles => {
      // Оновлюємо масив статей
      return currentArticles.map(article => {
        if (article.id === articleId) {
          // Якщо ID співпадає, створюємо новий масив коментарів
          const updatedComments = [...article.comments, newComment];
          // Повертаємо копію статті з оновленими коментарями
          return { ...article, comments: updatedComments };
        }
        // Інакше повертаємо статтю без змін
        return article;
      });
    });
     // Лог для відстеження (можна видалити або замінити на повідомлення)
     console.log('Коментар додано до статті:', articleId, newComment);
  };


  // Сортування статей перед рендерингом на основі стану sortByDate
  const sortedArticles = [...articles].sort((a, b) => {
    // Перетворення рядка дати в об'єкт Date для порівняння
    const dateA = new Date(a.date.split('.').reverse().join('-'));
    const dateB = new Date(b.date.split('.').reverse().join('-'));
    // Сортування за зростанням або спаданням
    return sortByDate === 'asc' ? dateA - dateB : dateB - dateA;
  });


  return (
    <section id="articles" className="articles-section">
      <h2>Статті</h2>
      {/* Елементи керування сортуванням */}
      <div className="sort-controls">
        <label htmlFor="sort-date">Сортувати за датою:</label>
        <select id="sort-date" value={sortByDate} onChange={handleSortChange}>
          <option value="desc">Спочатку новіші</option>
          <option value="asc">Спочатку старіші</option>
        </select>
      </div>
      {/* Список відсортованих статей */}
      <div className="articles-list">
        {sortedArticles.map(article => (
          // Передача даних статті та функції додавання коментаря до компонента ArticleCard
          <ArticleCard
            key={article.id}
            article={article}
            handleAddComment={handleAddComment}
          />
        ))}
      </div>
    </section>
  );
}

// Експорт компонента за замовчуванням
export default ArticleList;
